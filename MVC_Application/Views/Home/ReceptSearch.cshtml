@model List<DTO.ReceptDTO>

@{
    ViewData["Title"] = "Home Page";
    var cpr = (string)ViewBag.Cpr;
    var apotekId = (Guid)ViewBag.Apotek.ApotekId;
}

<div style="text-align:center; margin-top:20px;">
    @using (Html.BeginForm("GetRecepter", "Home", FormMethod.Get))
    {
        <input type="hidden" name="apotekId" value="@ViewBag.Apotek.ApotekId" />

        <p style="margin-bottom:20px;">
            <label style="font-weight:bold;">
                Cprnummer:
                <input type="text" name="cpr" style="margin-left:10px; padding:4px;" />
            </label>
            <input type="submit" value="Hent" style="margin-left:10px; padding:4px 10px;" />
        </p>
    }

    <h2>Recepter for @ViewBag.Apotek.Navn</h2>
    <h3>Patient CPR: @cpr</h3>

    @if (Model != null && Model.Any())
    {
        @foreach (var recept in Model)
        {
            <div style="
                border: 1px solid #ccc;
                border-radius: 8px;
                padding: 15px 20px;
                margin: 20px auto;
                width: 80%;
                text-align: left;
                box-shadow: 0 0 5px rgba(0,0,0,0.05);
            ">
                <h4 style="margin-top:0; margin-bottom:10px;">Recept: @recept.ReceptId</h4>

                <div style="margin-bottom:10px; line-height:1.6;">
                    <div><strong>CPR:</strong> @recept.PatientCpr</div>
                    <div><strong>Lægehus Ydernummer:</strong> @recept.LægehusId</div>
                    <div><strong>Oprettelsesdato:</strong> @recept.OprettelsesDato.ToString("D")</div>
                </div>

                <table style="
                    margin: 10px auto 0 auto;
                    border-collapse: collapse;
                    width: 100%;
                    text-align: center;
                    font-size: 16px;
                ">
                    <tr style="background-color:#f2f2f2;">
                        <th style="padding:10px; border:1px solid #ddd;">Lægemiddel</th>
                        <th style="padding:10px; border:1px solid #ddd">Dosis</th>
                        <th style="padding:10px; border:1px solid #ddd;">Mulige udleveringer</th>
                        <th style="padding:10px; border:1px solid #ddd;">Foretagede udleveringer</th>
                        <th style="padding:10px; border:1px solid #ddd;">Handling</th>
                    </tr>

                    @if (recept.Ordinationer != null && recept.Ordinationer.Any())
                    {
                        @foreach (var ordination in recept.Ordinationer)
                        {
                            <tr>
                                <td style="padding:8px; border:1px solid #ddd;">@ordination.Lægemiddel</td>
                                <td style="padding:8px; border:1px solid #ddd;">@ordination.Dosis</td>
                                <td style="padding:8px; border:1px solid #ddd;">@ordination.AntalUdleveringer</td>
                                <td style="padding:8px; border:1px solid #ddd;">@ordination.AntalForetagneUdleveringer</td>
                                <td style="padding:8px; border:1px solid #ddd;">
                                    @using (Html.BeginForm("ForetagUdlevering", "Home", FormMethod.Post))
                                    {
                                        @Html.Hidden("cpr", cpr)
                                        @Html.Hidden("apotekId", apotekId)
                                        @Html.Hidden("receptId", recept.ReceptId)
                                        @Html.Hidden("ordinationId", ordination.OrdinationId)
                                        @if (ordination.AntalUdleveringer == ordination.AntalForetagneUdleveringer)
                                        {
                                            <p style="color: red">Ordinationen er lukket</p>
                                        }
                                        else
                                        {
                                            <button type="submit"
                                                    onclick="return confirm('Er du sikker?')"
                                                    style="padding:4px 8px;">
                                                Foretag udlevering
                                            </button>
                                        }
                                    }
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4" style="padding:10px; border:1px solid #ddd; font-style:italic;">
                                Ingen ordinationer på denne recept
                            </td>
                        </tr>
                    }
                </table>
            </div>
        }
    }
    else
    {
        <h5>Ingen recepter fundet.</h5>
    }
</div>
